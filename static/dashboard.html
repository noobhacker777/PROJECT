<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SAMP Unified - Master Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); padding: 30px; }
    h1 { color: #333; margin-bottom: 10px; text-align: center; }
    .subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 30px; }
    .card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 12px; color: white; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    .card h3 { margin-bottom: 6px; font-size: 14px; }
    .card p { font-size: 11px; opacity: 0.9; }
    .section { margin-bottom: 30px; }
    .section h2 { border-bottom: 2px solid #667eea; padding-bottom: 10px; margin-bottom: 15px; color: #333; }
    .control-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
    .control-row input, .control-row select { flex: 1; min-width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    .control-row button { padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background 0.2s; }
    .control-row button:hover { background: #764ba2; }
    .output { background: #f7f7f7; padding: 15px; border-radius: 4px; border-left: 4px solid #667eea; font-size: 13px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; font-family: monospace; }
    .progress-bar { width: 100%; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; margin: 10px 0; }
    .progress-fill { height: 100%; background: #667eea; width: 0%; transition: width 0.3s; }
    .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
    .status.ok { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
    .status.info { background: #d1ecf1; color: #0c5460; }
    @keyframes pulse { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>ü§ñ SAMP Unified - Master Dashboard</h1>
    <div class="subtitle">Single-site label, train, and scan ‚Äî all in one place</div>

    <!-- API Preview (shows raw JSON from last API call) -->
    <div id="apiPreview" class="output" style="display:none; margin-bottom:16px;"></div>

    <!-- Quick Actions -->
    <div class="grid">
      <div class="card" onclick="switchTab('dataset')">
        <h3>üìä Dataset</h3>
        <p>View dataset and filter by SKU</p>
      </div>
      <div class="card" onclick="switchTab('label')">
        <h3>üìù Label</h3>
        <p>Annotate images with bounding boxes + 2-tier hierarchy</p>
      </div>
      <div class="card" onclick="switchTab('scan')">
        <h3>üîç Scan</h3>
        <p>Analyze dataset and label quality</p>
      </div>
      <div class="card" onclick="switchTab('train')">
        <h3>üöÄ Train</h3>
        <p>Full training or fine-tuning</p>
      </div>
      <div class="card" onclick="switchTab('backups')">
        <h3>üíæ Backups</h3>
        <p>Manage model backups and history</p>
      </div>
    </div>

    <!-- HIERARCHICAL 4-LEVEL Section - REMOVED, now integrated in LABEL -->

    <!-- DATASET Section -->
    <div id="tab-dataset" class="section" style="display:none;">
      <h2>üìä Dataset Manager</h2>
      
      <!-- Dataset Summary Stats -->
      <div id="datasetSummary" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(130px, 1fr)); gap:12px; margin-bottom:20px;">
        <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; padding:15px; border-radius:8px; text-align:center;">
          <div style="font-size:12px; opacity:0.9;">Total Images</div>
          <div style="font-size:28px; font-weight:bold; margin-top:8px;" id="summaryImages">-</div>
        </div>
        <div style="background:linear-gradient(135deg, #764ba2 0%, #f093fb 100%); color:white; padding:15px; border-radius:8px; text-align:center;">
          <div style="font-size:12px; opacity:0.9;">Total SKUs</div>
          <div style="font-size:28px; font-weight:bold; margin-top:8px;" id="summarySkus">-</div>
        </div>
        <div style="background:linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color:white; padding:15px; border-radius:8px; text-align:center;">
          <div style="font-size:12px; opacity:0.9;">Dataset Location</div>
          <div style="font-size:14px; font-weight:bold; margin-top:8px;" id="summaryLocation">openclip_dataset/</div>
        </div>
      </div>
      
      <!-- Main Content Area (SKU List or Images) -->
      <div id="datasetMainContent" style="background:white; border-radius:8px; border:1px solid #ddd; overflow:hidden;">
        <!-- SKU List View -->
        <div id="skuListView" style="display:block;">
          <!-- Filter and Search -->
          <div style="padding:15px; background:#f9f9f9; border-bottom:1px solid #ddd; display:flex; gap:10px; align-items:flex-end; flex-wrap:wrap;">
            <div style="flex:1; min-width:200px;">
              <label style="display:block; margin-bottom:6px; font-weight:bold; font-size:12px; color:#333;">Select SKU:</label>
              <select id="skuSearchFilter" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
                <option value="">-- All SKUs --</option>
              </select>
            </div>
            <button onclick="filterSkuList()" style="padding:8px 16px; background:#0dcaf0; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:12px; height:36px;">üîç Search</button>
            <button onclick="resetSkuFilter()" style="padding:8px 16px; background:#6c757d; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:12px; height:36px;">‚úï Reset</button>
          </div>
          
          <!-- SKU Table -->
          <div style="overflow-x:auto; max-height:600px; overflow-y:auto;">
            <table style="width:100%; border-collapse:collapse; font-size:12px;">
              <thead>
                <tr style="background:#667eea; color:white; font-weight:bold; position:sticky; top:0;">
                  <th style="padding:10px; border:1px solid #ddd; text-align:left; width:25%;">SKU Name</th>
                  <th style="padding:10px; border:1px solid #ddd; text-align:center; width:15%;">Images</th>
                  <th style="padding:10px; border:1px solid #ddd; text-align:center; width:20%;">Size (MB)</th>
                  <th style="padding:10px; border:1px solid #ddd; text-align:center; width:40%;">Actions</th>
                </tr>
              </thead>
              <tbody id="datasetSkuTableBody" style="background:white;">
                <tr style="background:#f9f9f9;">
                  <td colspan="4" style="padding:20px; text-align:center; color:#999; font-size:12px;">Loading SKU list...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Image Grid View -->
        <div id="imageGridView" style="display:none; padding:20px;">
          <div style="display:flex; gap:10px; align-items:center; margin-bottom:20px; padding-bottom:15px; border-bottom:2px solid #0dcaf0;">
            <button onclick="backToSkuList()" style="padding:8px 16px; background:#667eea; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:13px;">‚óÄ Back to SKU List</button>
            <h3 id="imageGridTitle" style="margin:0; color:#333; flex:1;">Loading images...</h3>
          </div>
          
          <!-- Upload and Search Section -->
          <div style="margin-bottom:20px; display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
            <!-- Search Images -->
            <div style="flex:1; min-width:250px;">
              <input type="text" id="imageSearchInput" placeholder="üîç Search images by name..." style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:13px;" oninput="searchImagesRealtime()">
            </div>
            
            <!-- Upload Images -->
            <div style="display:flex; gap:5px;">
              <label style="padding:8px 16px; background:#28a745; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:12px; display:inline-block;">
                üì§ Upload
                <input type="file" id="imageUploadInput" multiple accept="image/*" style="display:none;" onchange="uploadImages()">
              </label>
              <button onclick="clearImageSearch()" style="padding:8px 16px; background:#6c757d; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:12px;">‚úï Clear</button>
            </div>
          </div>
          
          <!-- Upload Progress -->
          <div id="uploadProgress" style="display:none; margin-bottom:15px; padding:10px; background:#e7f3ff; border:1px solid #0dcaf0; border-radius:4px;">
            <div style="font-size:12px; font-weight:bold; color:#0c5460; margin-bottom:5px;">Uploading...</div>
            <div id="uploadProgressBar" style="width:100%; height:6px; background:#ddd; border-radius:3px; overflow:hidden;">
              <div style="height:100%; background:#0dcaf0; width:0%; transition:width 0.3s;"></div>
            </div>
          </div>
          
          <div id="imageGridContainer" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:15px;"></div>
        </div>
      </div>
      
      <div id="datasetOut" class="output" style="margin-top:15px;"></div>
    </div>

    <!-- LABEL Section -->
    <div id="tab-label" class="section" style="display:none;">
      <h2>üìù Label Products (SKU Assignment)</h2>
      
      <!-- Image Selection -->
      <div class="control-row">
        <select id="labelImageList"></select>
        <button onclick="labelLoad()">Load Image</button>
        <button onclick="loadPreviousImage()" style="padding:8px 12px; background:#667eea; color:white; border:none; border-radius:4px; cursor:pointer;">‚óÄ Previous</button>
        <button onclick="loadNextImage()" style="padding:8px 12px; background:#667eea; color:white; border:none; border-radius:4px; cursor:pointer;">Next ‚ñ∂</button>
        <button onclick="labelClear()">Clear Boxes</button>
        <input type="file" id="labelUploadFile" accept="image/*" capture="environment" style="flex:1; max-width:220px;" />
        <button onclick="uploadLabelImage()">Upload Image</button>
      </div>
      
      <!-- Canvas + Class Panel -->
      <div style="display:grid; grid-template-columns:400px 1fr; gap:20px; margin:20px 0;">
        <!-- Canvas -->
        <div>
          <canvas id="labelCanvas" style="border: 1px solid #ddd; border-radius: 4px; display: block; background: #f9f9f9; max-width:400px; width:100%; height:auto;"></canvas>
        </div>
        
        <!-- Class Panel (Simplified) -->
        <div style="background:#f9f9f9; padding:15px; border-radius:4px; border:1px solid #ddd; display:flex; flex-direction:column; gap:12px;">
          <h3 style="margin:0; font-size:14px; color:#333;">üéØ Object Detection</h3>
          
          <!-- Class Info -->
          <div style="background:white; padding:12px; border-radius:4px; border-left:4px solid #667eea;">
            <label style="font-weight:bold; font-size:13px; display:block; margin-bottom:8px;">Class:</label>
            <div style="background:#e3f2fd; padding:10px; border-radius:4px; border-left:3px solid #0066cc; font-weight:bold; color:#0066cc;">
              üì¶ product
            </div>
            <small style="display:block; margin-top:8px; color:#666;">Single class detection model. Draw boxes around products.</small>
          </div>
          
          <!-- SKU Management -->
          <div style="background:white; padding:12px; border-radius:4px; border-left:4px solid #20c997;">
            <label style="font-weight:bold; font-size:13px; display:block; margin-bottom:8px;">üìã SKU Management:</label>
            <div style="display:flex; gap:8px; margin-bottom:12px;">
              <input type="text" id="skuInput" placeholder="Enter SKU (e.g., SKU_0001)" style="flex:1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
              <button onclick="addSKUToTable()" style="padding:8px 16px; background:#20c997; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:12px;">+ Add</button>
            </div>
            
            <div style="display:flex; gap:8px; margin-bottom:12px;">
              <input type="text" id="skuSearchInput" placeholder="üîç Search SKU..." style="flex:1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
            </div>
            
            <!-- SKU Table -->
            <div style="overflow-x:auto; max-height:160px; overflow-y:auto; border:1px solid #ddd; border-radius:4px;">
              <table style="width:100%; border-collapse:collapse; font-family:monospace; font-size:11px;">
                <thead>
                  <tr style="background:#20c997; color:white; font-weight:bold; position:sticky; top:0;">
                    <th style="padding:8px; border:1px solid #ddd; text-align:center; width:10%">#</th>
                    <th style="padding:8px; border:1px solid #ddd; text-align:left; flex:1;">SKU ID</th>
                    <th style="padding:8px; border:1px solid #ddd; text-align:center; width:15%;">Action</th>
                  </tr>
                </thead>
                <tbody id="skuTableBody" style="background:white;">
                  <tr style="background:#f9f9f9;">
                    <td colspan="3" style="padding:12px; text-align:center; color:#999; font-size:11px;">No SKUs added yet</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Box List with SKU Selector -->
          <div style="background:white; padding:12px; border-radius:4px; border-left:4px solid #0dcaf0; margin-top:12px;">
            <label style="font-weight:bold; font-size:13px; display:block; margin-bottom:8px;">üì¶ Box List & SKU Selector:</label>
            
            <!-- Box List Table -->
            <div style="overflow-x:auto; max-height:350px; overflow-y:auto; border:1px solid #ddd; border-radius:4px;">
              <table style="width:100%; border-collapse:collapse; font-family:monospace; font-size:11px;">
                <thead>
                  <tr style="background:#0dcaf0; color:white; font-weight:bold; position:sticky; top:0;">
                    <th style="padding:8px; border:1px solid #ddd; text-align:center; width:8%">#</th>
                    <th style="padding:8px; border:1px solid #ddd; text-align:left; width:45%;">Position</th>
                    <th style="padding:8px; border:1px solid #ddd; text-align:left; flex:1;">Assign SKU</th>
                    <th style="padding:8px; border:1px solid #ddd; text-align:center; width:15%;">Action</th>
                  </tr>
                </thead>
                <tbody id="boxListTableBody" style="background:white;">
                  <tr style="background:#f9f9f9;">
                    <td colspan="4" style="padding:12px; text-align:center; color:#999; font-size:11px;">No boxes detected</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Control Row -->
      <div class="control-row">
        <button onclick="cropAndSaveBoxes().then(() => { setTimeout(() => labelSaveHierarchical(), 500); }).catch(err => { console.error('Crop error:', err); labelSaveHierarchical(); })" style="padding:10px 16px; background:#007bff; color:white; font-weight:bold;">üíæ Save + Hierarchy (Ctrl+S)</button>
        <label style="display:flex; align-items:center; gap:6px; margin-left:8px; font-size:13px;">Border: <input id="labelBorderWidth" type="range" min="1" max="8" value="3" style="width:80px; margin-left:6px;"></label>
      </div>
      <div id="labelOut" class="output"></div>
      <div id="labelSaveLog" class="output" style="margin-top:10px; display:none;"></div>
    </div>

    <!-- Class chooser modal for dashboard label UI -->
    <div id="dashboardClassChooser" style="display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.45); align-items:center; justify-content:center; z-index:2000;">
      <div style="background:#fff; padding:14px; border-radius:8px; min-width:320px; margin:60px auto; box-shadow:0 6px 20px rgba(0,0,0,0.3);">
        <h3 style="margin:0 0 8px 0; font-size:16px;">Select label for new box</h3>
        <div style="display:flex; gap:8px; align-items:center;">
          <select id="dashboardClassSelect" style="flex:1; padding:6px; border:1px solid #ddd; border-radius:4px;"></select>
          <button id="dashboardClassNewBtn" style="padding:6px 8px;">New</button>
        </div>
        <input id="dashboardClassNewInput" placeholder="Enter new class name" style="display:none; margin-top:8px; padding:6px; width:100%; border:1px solid #ddd; border-radius:4px;" />
        <div style="margin-top:12px; text-align:right;">
          <button id="dashboardClassCancel" style="padding:6px 8px; margin-right:8px;">Cancel</button>
          <button id="dashboardClassOk" style="padding:6px 10px; background:#28a745; color:white; border:none; border-radius:4px;">OK</button>
        </div>
      </div>
    </div>

    <!-- SCAN Section -->
    <div id="tab-scan" class="section" style="display:none;">
      <h2>üîç 2-Tier Inference & Detection</h2>

      <!-- Product Detection Section -->
      <div style="background:#fff8e6; padding:15px; border-radius:8px; border-left:4px solid #ffc107; margin-bottom:20px;">
        <h3 style="margin:0 0 12px 0; color:#333; font-size:16px;">üõçÔ∏è Upload Image for Detection</h3>
        <p style="margin:0 0 12px 0; font-size:12px; color:#666;">Upload an image to detect products and match them to known SKUs</p>
        
        <div style="display:flex; gap:10px; margin-bottom:12px; flex-wrap:wrap;">
          <input type="file" id="detectImageFile" accept="image/*" style="flex:1; min-width:200px; padding:8px; border:1px solid #ddd; border-radius:4px;" />
          <button onclick="scanAndDetect()" style="padding:8px 16px; background:#ffc107; color:#333; border:none; border-radius:4px; cursor:pointer; font-weight:bold; height:36px; white-space:nowrap;">üîç Detect Products</button>
        </div>
        
        <div id="detectionProgress" style="display:none; margin-bottom:12px;">
          <div style="font-size:12px; margin-bottom:6px; color:#333;">Processing...</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:100%; animation:pulse 1.5s infinite;"></div>
          </div>
        </div>
        
        <!-- Detection Results Modal -->
        <div id="detectionResultsModal" style="display:none; margin-top:15px; background:white; padding:15px; border-radius:8px; border:1px solid #ddd;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <h4 style="margin:0; color:#333;">üìä Detection Results</h4>
            <button onclick="closeDetectionResults()" style="background:none; border:none; font-size:20px; cursor:pointer;">√ó</button>
          </div>
          
          <div id="detectionStats" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:10px; margin-bottom:15px;">
            <div style="background:#d4edda; padding:10px; border-radius:6px; text-align:center;">
              <div style="font-size:11px; color:#155724; font-weight:bold;">Products Detected</div>
              <div style="font-size:24px; font-weight:bold; color:#155724; margin-top:6px;" id="detectionCount">0</div>
            </div>
            <div style="background:#d1ecf1; padding:10px; border-radius:6px; text-align:center;">
              <div style="font-size:11px; color:#0c5460; font-weight:bold;">Unique SKUs</div>
              <div style="font-size:24px; font-weight:bold; color:#0c5460; margin-top:6px;" id="uniqueSkuCount">0</div>
            </div>
          </div>
          
          <!-- Detection Image Preview -->
          <div style="margin-bottom:15px;">
            <div style="font-size:12px; font-weight:bold; color:#333; margin-bottom:8px;">Uploaded Image:</div>
            <img id="detectionImagePreview" src="" style="max-width:100%; max-height:400px; border-radius:6px; border:1px solid #ddd;" />
          </div>
          
          <!-- Detected Products Table -->
          <div style="margin-bottom:15px;">
            <div style="font-size:12px; font-weight:bold; color:#333; margin-bottom:8px;">Detected Products:</div>
            <table style="width:100%; border-collapse:collapse; font-size:11px;">
              <tr style="background:#f0f0f0; font-weight:bold;">
                <td style="padding:8px; border:1px solid #ddd; width:10%;">ID</td>
                <td style="padding:8px; border:1px solid #ddd; width:15%;">Confidence</td>
                <td style="padding:8px; border:1px solid #ddd; width:20%;">Bounding Box (x,y,w,h)</td>
                <td style="padding:8px; border:1px solid #ddd; width:20%;">Matched SKU</td>
                <td style="padding:8px; border:1px solid #ddd; width:20%;">SKU Similarity</td>
              </tr>
              <tbody id="detectionTableBody">
              </tbody>
            </table>
          </div>
          
          <!-- SKU Matches Summary -->
          <div style="margin-bottom:15px;">
            <div style="font-size:12px; font-weight:bold; color:#333; margin-bottom:8px;">SKU Matches Summary:</div>
            <div id="skuMatchesList" style="display:grid; gap:8px;">
            </div>
          </div>
          
          <!-- Cropped Products Preview -->
          <div id="cropsSection" style="display:none; margin-top:15px;">
            <div style="font-size:12px; font-weight:bold; color:#333; margin-bottom:8px;">üñºÔ∏è Detected Crops:</div>
            <img id="detectionCropsPreview" src="" style="max-width:100%; max-height:300px; border-radius:6px; border:1px solid #ddd;" />
          </div>
          
          <div style="display:flex; gap:10px; margin-top:15px;">
            <button onclick="openDetectionInNewTab()" style="flex:1; padding:10px; background:#0d6efd; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">üîó Open Full Results in New Tab</button>
            <button onclick="downloadDetectionJSON()" style="flex:1; padding:10px; background:#6c757d; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">üì• Download JSON</button>
          </div>
        </div>
      </div>
      
      <!-- Unified Detection Results -->
      <div id="scanResult" style="margin:20px 0; display:none;">
        <h3 style="margin-bottom:15px; color:#333;">üìä Unified Detection Results</h3>
        <div style="background:#f8f9fa; padding:15px; border-radius:8px; border-left:4px solid #667eea;">
          
          <!-- Combined Detection Summary -->
          <div id="unifiedResult" style="background:white; padding:15px; border-radius:6px; border-left:5px solid #667eea; margin-bottom:20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
              <h4 style="margin:0; color:#333; font-size:16px;">üéØ Detection Summary</h4>
              <div style="display:flex; gap:10px;">
                <span id="productCountBadge" style="background:#667eea; color:white; padding:6px 12px; border-radius:20px; font-weight:bold; font-size:13px;">0 Products</span>
                <span id="skuCountBadge" style="background:#764ba2; color:white; padding:6px 12px; border-radius:20px; font-weight:bold; font-size:13px;">0 SKUs</span>
              </div>
            </div>
            
            <!-- Summary Stats -->
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:12px; margin-bottom:15px;">
              <div style="background:#f0f0f0; padding:12px; border-radius:6px;">
                <div style="font-size:11px; color:#666; font-weight:bold;">Total Detections</div>
                <div style="font-size:20px; font-weight:bold; color:#667eea; margin-top:6px;" id="detectionCount">0</div>
              </div>
              <div style="background:#f0f0f0; padding:12px; border-radius:6px;">
                <div style="font-size:11px; color:#666; font-weight:bold;">Image Dimensions</div>
                <div style="font-size:14px; font-weight:bold; color:#333; margin-top:6px; font-family:monospace;" id="imageDimensions">-</div>
              </div>
              <div style="background:#f0f0f0; padding:12px; border-radius:6px;">
                <div style="font-size:11px; color:#666; font-weight:bold;">Unique SKUs</div>
                <div style="font-size:20px; font-weight:bold; color:#764ba2; margin-top:6px;" id="uniqueSkuCount">0</div>
              </div>
            </div>
            
            <!-- Detections Details -->
            <details style="cursor:pointer;">
              <summary style="padding:10px; background:#f0f0f0; border-radius:4px; font-weight:bold; font-size:12px; cursor:pointer;">üì¶ Detected Products Breakdown</summary>
              <div id="detectionDetails" style="margin-top:10px; padding:10px; background:#fafafa; border-radius:4px; border-left:3px solid #667eea; font-size:11px; font-family:monospace; max-height:250px; overflow-y:auto; white-space:pre-wrap; word-break:break-word;">
                -
              </div>
            </details>
          </div>
          
          <!-- Raw JSON View -->
          <details style="cursor:pointer; margin-top:20px;">
            <summary style="padding:10px; background:#f0f0f0; border-radius:4px; font-weight:bold; font-size:12px;">üìã Raw JSON (Click to expand)</summary>
            <div id="scanRawJson" style="margin-top:10px; padding:15px; background:#1e1e1e; color:#00ff00; border-radius:4px; font-size:11px; font-family:monospace; max-height:400px; overflow-y:auto; white-space:pre-wrap; word-break:break-word;">
              {}
            </div>
          </details>
        </div>
      </div>
      
      <div id="scanOut" class="output"></div>
      <div id="scanVis" style="margin-top:10px;"></div>
    </div>

    <!-- TRAIN Section -->
    <div id="tab-train" class="section" style="display:none;">
      <h2>üöÄ Model Training</h2>
      <div style="background:#fff; padding:15px; border-radius:4px; border:1px solid #ddd; margin-bottom:20px;">
        <h3 style="margin-bottom:12px; font-size:16px;">Training Parameters</h3>
        
        <div class="control-row" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:15px; margin-bottom:15px;">
          <div>
            <label style="display:block; margin-bottom:5px; font-weight:bold; font-size:13px;">Epochs:</label>
            <select id="trainEpochs" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:13px;">
              <option value="50">50 (Quick)</option>
              <option value="100" selected>100 (Standard)</option>
              <option value="200">200 (Better)</option>
              <option value="500">500 (High Accuracy)</option>
              <option value="1000">1000 (Very High)</option>
            </select>
            <p style="font-size:12px; color:#666; margin:5px 0 0 0;">Training cycles</p>
          </div>
          
          <div>
            <label style="display:block; margin-bottom:5px; font-weight:bold; font-size:13px;">Image Size:</label>
            <select id="trainImgsz" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:13px;">
              <option value="320">320px (Fast)</option>
              <option value="416">416px</option>
              <option value="512">512px</option>
              <option value="640" selected>640px (Recommended)</option>
              <option value="800">800px (Detailed)</option>
              <option value="1024">1024px (Very Detailed)</option>
            </select>
            <p style="font-size:12px; color:#666; margin:5px 0 0 0;">Input image size</p>
          </div>
          
          <div>
            <label style="display:block; margin-bottom:5px; font-weight:bold; font-size:13px;">Batch Size:</label>
            <select id="trainBatch" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:13px;">
              <option value="4">4 (Small GPU)</option>
              <option value="8" selected>8 (Standard)</option>
              <option value="16">16 (Larger GPU)</option>
              <option value="32">32 (High VRAM)</option>
              <option value="64">64 (Lots VRAM)</option>
            </select>
            <p style="font-size:12px; color:#666; margin:5px 0 0 0;">Batch size</p>
          </div>
        </div>
        
        <div class="control-row" style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px;">
          <div>
            <label style="display:block; margin-bottom:5px; font-weight:bold; font-size:13px;">Device:</label>
            <select id="trainDevice" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
              <option value="0" selected>GPU (CUDA)</option>
              <option value="cpu">CPU</option>
            </select>
            <p style="font-size:12px; color:#666; margin:5px 0 0 0;">Compute device</p>
          </div>
          
          <div>
            <label style="display:block; margin-bottom:5px; font-weight:bold; font-size:13px;">Patience:</label>
            <select id="trainPatience" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
              <option value="10">10 (Quick stop)</option>
              <option value="20">20 (Balanced)</option>
              <option value="50">50</option>
              <option value="100" selected>100 (High accuracy)</option>
              <option value="200">200 (Very patient)</option>
            </select>
            <p style="font-size:12px; color:#666; margin:5px 0 0 0;">Early stopping patience</p>
          </div>
        </div>
        
        <div style="background:#f5f5f5; padding:10px; border-radius:4px; margin-bottom:15px; border-left:3px solid #667eea;">
          <p style="font-size:12px; color:#333; margin:0;">
            üìä <strong>Training Info:</strong><br>
            ‚Ä¢ <strong>Train from Start:</strong> Uses base HOLO11 model, better for new datasets<br>
            ‚Ä¢ <strong>Fine-tune:</strong> Uses existing trained model, faster convergence<br>
            ‚Ä¢ Dataset: 18 images with 40 annotations<br>
            ‚Ä¢ Augmentation: Mosaic, mixup, color jitter enabled<br>
            ‚Ä¢ Auto-backup: Models saved at each epoch<br>
            ‚Ä¢ Early stopping: Prevents overfitting<br>
            <strong>Current Config:</strong> <span id="configPreview" style="font-family:monospace; color:#667eea;">100ep √ó 640px √ó 8batch</span>
          </p>
        </div>
        
        <button onclick="startTrain()" style="width:100%; padding:12px; background:#667eea; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; font-size:14px;">‚ñ∂ Start Training</button>
      </div>
      
      <div class="status info" id="trainStatus" style="display:none;"></div>
      <div class="progress-bar"><div class="progress-fill" id="trainProgress"></div></div>
      <div id="trainOut" class="output"></div>
    </div>



    <!-- BACKUPS Section -->
    <div id="tab-backups" class="section" style="display:none;">
      <h2>üíæ Model Backups</h2>
      <div style="margin-bottom:15px;">
        <button onclick="loadBackups()" style="padding:10px 16px; background:#667eea; color:white; border:none; border-radius:4px; cursor:pointer;">üîÑ Refresh Backup List</button>
      </div>
      <div id="backupsList" style="background:#f7f7f7; padding:15px; border-radius:4px; border:1px solid #ddd;">
        <table style="width:100%; border-collapse:collapse; font-size:13px;">
          <thead>
            <tr style="background:#667eea; color:white; font-weight:bold;">
              <th style="padding:10px; text-align:left; border:1px solid #ddd;">Filename</th>
              <th style="padding:10px; text-align:center; border:1px solid #ddd;">Size (MB)</th>
              <th style="padding:10px; text-align:left; border:1px solid #ddd;">Modified</th>
              <th style="padding:10px; text-align:center; border:1px solid #ddd;">Action</th>
            </tr>
          </thead>
          <tbody id="backupsTable">
            <tr><td colspan="4" style="padding:20px; text-align:center; color:#999;">Loading backups...</td></tr>
          </tbody>
        </table>
      </div>
      <div id="backupOut" class="output" style="margin-top:10px; display:none;"></div>
    </div>



    <!-- Infer, Package, and Monitor sections removed to simplify UI; use Scan and Train sections instead -->
  </div>

  <script src="dashboard.js"></script>
</body>
<!-- SKU Management Modals -->

<!-- Add Single SKU Modal -->
<div id="addSKUModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
  <div style="background:white; padding:25px; border-radius:8px; box-shadow:0 4px 20px rgba(0,0,0,0.3); width:90%; max-width:400px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
      <h2 style="margin:0; font-size:18px;">‚ûï Add New SKU</h2>
      <button onclick="closeAddSKUPopup()" style="background:none; border:none; font-size:24px; cursor:pointer; color:#999;">√ó</button>
    </div>
    
    <div style="margin-bottom:20px;">
      <label style="font-weight:bold; display:block; margin-bottom:8px; font-size:14px;">SKU ID:</label>
      <input type="text" id="newSKUInput" placeholder="e.g., SKU_0001, PROD_ABC" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:14px; box-sizing:border-box;">
      <small style="display:block; margin-top:6px; color:#999;">Alphanumeric, no spaces</small>
    </div>
    
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
      <button onclick="closeAddSKUPopup()" style="padding:10px; background:#e9ecef; border:1px solid #ddd; border-radius:4px; cursor:pointer; font-weight:bold;">Cancel</button>
      <button onclick="addSingleSKU()" style="padding:10px; background:#20c997; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">Add SKU</button>
    </div>
  </div>
</div>

<!-- Bulk Add SKU Modal -->
<div id="bulkSKUModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
  <div style="background:white; padding:25px; border-radius:8px; box-shadow:0 4px 20px rgba(0,0,0,0.3); width:90%; max-width:500px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
      <h2 style="margin:0; font-size:18px;">üìã Bulk Add SKUs</h2>
      <button onclick="closeBulkSKUPopup()" style="background:none; border:none; font-size:24px; cursor:pointer; color:#999;">√ó</button>
    </div>
    
    <div style="margin-bottom:20px;">
      <label style="font-weight:bold; display:block; margin-bottom:8px; font-size:14px;">Paste SKUs (one per line or comma-separated):</label>
      <textarea id="bulkSKUInput" placeholder="SKU_0001&#10;SKU_0002&#10;SKU_0003&#10;&#10;Or: SKU_0001, SKU_0002, SKU_0003" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:12px; font-family:monospace; box-sizing:border-box; height:150px; resize:vertical;"></textarea>
      <small style="display:block; margin-top:6px; color:#999;">Separate by commas or line breaks</small>
    </div>
    
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
      <button onclick="closeBulkSKUPopup()" style="padding:10px; background:#e9ecef; border:1px solid #ddd; border-radius:4px; cursor:pointer; font-weight:bold;">Cancel</button>
      <button onclick="addBulkSKUs()" style="padding:10px; background:#0dcaf0; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">Add All SKUs</button>
    </div>
  </div>
</div>

</html>